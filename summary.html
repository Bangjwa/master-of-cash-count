<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì •ì‚° ê²°ê³¼ ë³´ê¸°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .amount { font-weight: bold; color: #0066cc; }
  </style>
</head>
<body>
  <h2 id="title">ğŸ“‹ ì •ì‚° ê²°ê³¼</h2>
  <div id="summary"></div>

  <script>
    function parseQueryParams() {
      const params = new URLSearchParams(window.location.search);
      const total = params.get("total");
      const title = decodeURIComponent(params.get("title") || "ì •ì‚° ë‚´ì—­");
      const peopleStr = params.get("people");
      const breakdownStr = params.get("breakdown");

      document.getElementById("title").innerText = `ğŸ“‹ ${title}`;

      let html = "";
      if (total) {
        html += `<p>ì´ ì •ì‚° ê¸ˆì•¡: <span class="amount">â‚©${Number(total).toLocaleString()}</span></p>`;
      }

      const breakdownMap = {};
      if (breakdownStr) {
        breakdownStr.split(",").forEach(entry => {
          const [name, details] = entry.split("=");
          const sectionList = details.split("|");
          breakdownMap[decodeURIComponent(name)] = sectionList.map(item => {
            const [section, amount] = item.split(":");
            return { section, amount: Number(amount) };
          });
        });
      }

      if (peopleStr) {
        html += `<ul>`;
        const people = peopleStr.split(",");
        people.forEach(pair => {
          const [nameEncoded, amount] = pair.split(":");
          const name = decodeURIComponent(nameEncoded);
          html += `<li><strong>${name}</strong>: â‚©${Number(amount).toLocaleString()}`;

          const breakdown = breakdownMap[name];
          if (breakdown && breakdown.length > 0) {
            html += `<ul>`;
            breakdown.forEach(part => {
              html += `<li>${part.section}: â‚©${part.amount.toLocaleString()}</li>`;
            });
            html += `</ul>`;
          }

          html += `</li>`;
        });
        html += `</ul>`;
      } else {
        html += "<p>ì •ì‚° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      }

      document.getElementById("summary").innerHTML = html;
    }

    window.onload = parseQueryParams;
  </script>
</body>
</html>
