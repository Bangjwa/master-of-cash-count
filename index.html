<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì •ì‚°ì™•ìºì‹œí‚¹</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 1rem;
      line-height: 1.4;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      width: 100%;
      padding: 1rem;
      background: #4a90e2;
      color: white;
      font-size: 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .result {
      background: #eef;
      border: 1px solid #ccd;
      padding: 0.5rem;
      border-radius: 6px;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <img src="https://bangjwa.github.io/master-of-cash-count/cach-count-top.png" style="width: 100%" />
  <h2>ì •ì‚°ì™•ìºì‹œí‚¹ (ì¹´í†¡ì •ì‚°ë„ìš°ë¯¸)</h2>

  <div class="card">
    <label>ì •ì‚°ëª…</label>
    <input type="text" id="settlement_title" placeholder="ì˜ˆ: 2025ë…„ 1ì›” 1ì¼ í™”ê²½ ë¯¸ìŠ¤í„°ìœ " />
  </div>
  
  <div class="card">
    <label>ì •ì‚° ì´ì•¡</label>
    <input type="number" id="totalAmount" placeholder="ì˜ˆ: 100000" />
  </div>

  <div class="card">
    <label>ìˆ  ê¸ˆì•¡</label>
    <input type="number" id="alcoholAmount" placeholder="ì˜ˆ: 20000" />
    <label>ìˆ  ì°¸ì—¬ì (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input type="text" id="alcoholPeople" placeholder="ì˜ˆ: í™ê¸¸ë™,ê¹€ì² ìˆ˜" />
  </div>

  <div class="card">
    <label>ì•ˆì£¼ ê¸ˆì•¡</label>
    <input type="number" id="foodAmount" placeholder="ì˜ˆ: 20000" />
    <label>ì•ˆì£¼ ì°¸ì—¬ì (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input type="text" id="foodPeople" placeholder="ì˜ˆ: í™ê¸¸ë™,ê¹€ì² ìˆ˜" />
  </div>

  <div class="card">
    <label>ìŒë£Œ ê¸ˆì•¡</label>
    <input type="number" id="beverageAmount" placeholder="ì˜ˆ: 20000" />
    <label>ìŒë£Œ ì°¸ì—¬ì (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input type="text" id="beveragePeople" placeholder="ì˜ˆ: í™ê¸¸ë™,ê¹€ì² ìˆ˜" />
  </div>

  <div class="card">
    <button onclick="calculate()">ì •ì‚° ê³„ì‚°í•˜ê¸°</button>
    <div id="summary" class="result"></div>
    <div id="result" class="result"></div>
  </div>

  <div id="shareBtnContainer" style="display:none; text-align:center; margin-top: 20px;">
    <a id="kakaotalk-sharing-btn" href="javascript:void(0);" onclick="validateAndShare()">
      <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png"
        alt="ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë³´ë‚´ê¸° ë²„íŠ¼" />
    </a>
  </div>

  <script>
    function parsePeople(str) {
      return str.split(',').map(p => p.trim()).filter(Boolean);
    }

    function calculate() {
      const total = Number(document.getElementById("totalAmount").value || 0);
      const sections = [
        {
          key: "ìˆ ",
          amount: Number(document.getElementById("alcoholAmount").value || 0),
          people: parsePeople(document.getElementById("alcoholPeople").value)
        },
        {
          key: "ì•ˆì£¼",
          amount: Number(document.getElementById("foodAmount").value || 0),
          people: parsePeople(document.getElementById("foodPeople").value)
        },
        {
          key: "ìŒë£Œ",
          amount: Number(document.getElementById("beverageAmount").value || 0),
          people: parsePeople(document.getElementById("beveragePeople").value)
        }
      ];
    
      let userMap = {};
      let sectionSum = 0;
    
      sections.forEach(section => {
        const perPerson = section.people.length > 0 ? section.amount / section.people.length : 0;
        sectionSum += section.amount;
    
        section.people.forEach(name => {
          if (!userMap[name]) userMap[name] = { total: 0, breakdown: {} };
          userMap[name].total += perPerson;
          userMap[name].breakdown[section.key] = (userMap[name].breakdown[section.key] || 0) + perPerson;
        });
      });
    
      const diff = total - sectionSum;
      let summaryText = `ì´ì•¡: â‚©${total.toLocaleString()}<br/>í•­ëª© í•©ê³„: â‚©${sectionSum.toLocaleString()}<br/>`;
      if (diff === 0) {
        summaryText += "<strong>ì •ì‚° ì´ì•¡ê³¼ í•­ëª© í•©ê³„ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.</strong>";
        document.getElementById("shareBtnContainer").style.display = "block";  // ê³µìœ  ë²„íŠ¼ í‘œì‹œ
      } else {
        if (diff > 0) {
          summaryText += `<strong>â‚©${diff.toLocaleString()} ë¯¸ë‹¬ì…ë‹ˆë‹¤.</strong>`;
        } else {
          summaryText += `<strong>â‚©${Math.abs(diff).toLocaleString()} ì´ˆê³¼ì…ë‹ˆë‹¤.</strong>`;
        }
        document.getElementById("shareBtnContainer").style.display = "none";  // ê³µìœ  ë²„íŠ¼ ìˆ¨ê¹€
      }
      document.getElementById("summary").innerHTML = summaryText;
    
        // ğŸ“‹ ê²°ê³¼ ì¶œë ¥
        let resultText = "<strong>ğŸ“‹ 1ì¸ë‹¹ ì •ì‚° ê¸ˆì•¡</strong><br/>";
        let shareContent = `ì´ ì •ì‚° ê¸ˆì•¡: â‚©${total.toLocaleString()}\n\n`;  // ê³µìœ ìš© í…ìŠ¤íŠ¸ ì‹œì‘
      
        Object.entries(userMap).forEach(([name, data]) => {
          resultText += `<br/><strong>${name}:</strong> â‚©${Math.round(data.total).toLocaleString()}<br/>`;
          shareContent += `â€¢ ${name}: â‚©${Math.round(data.total).toLocaleString()} (`; // ê³µìœ  ë©”ì‹œì§€ ì‹œì‘
          const breakdowns = Object.entries(data.breakdown).map(
            ([section, amount]) => `${section}`
          );
          resultText += Object.entries(data.breakdown)
            .map(([section, amount]) => `- ${section}: â‚©${Math.round(amount).toLocaleString()}<br/>`)
            .join("");
          shareContent += `${breakdowns.join(", ")})\n`;  // ê³µìœ  ë©”ì‹œì§€ ë
        });
      
        document.getElementById("result").innerHTML = resultText;
      
        // âœ… ê³µìœ ìš© ì „ì—­ ë³€ìˆ˜ ì €ì¥
        window.kakaoShareContent = shareContent;
      
    }

    function validateAndShare() {
      const settlement_title = document.getElementById("settlement_title").value.trim();
  
      // ìœ íš¨ì„± ê²€ì‚¬
      if (settlement_title === "") {
        alert("ì •ì‚°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
  
      // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì‹¤í–‰
      Kakao.Share.sendCustom({
        templateId: 122936,
        templateArgs: {
          "CASH_TITLE": settlement_title,
          "CASH_CONTENT": window.kakaoShareContent
        }
      });
    }
  </script>

</body>
</html>
